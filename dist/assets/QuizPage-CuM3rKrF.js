import{d as P,b as D,a as $,r as s,j as e,S as R,A as X}from"./index-Bx6DPSim.js";import{g as G}from"./aiTutorService-D0WICzOD.js";import"./index-BTdfOqQp.js";const v="naija-tutor-quiz-",H=1e3*60*60;function O(c){const r=`${v}${c.toLowerCase().replace(/\s/g,"-")}`;try{const n=localStorage.getItem(r);if(!n)return null;const o=JSON.parse(n);return Date.now()-o.timestamp>H?(localStorage.removeItem(r),null):o.questions}catch(n){return console.error("Failed to read quiz from cache:",n),null}}function T(c,r){const n=`${v}${c.toLowerCase().replace(/\s/g,"-")}`,o={timestamp:Date.now(),questions:r};try{localStorage.setItem(n,JSON.stringify(o))}catch(u){console.error("Failed to save quiz to cache:",u)}}const J=()=>{const{subject:c}=P(),r=D(),{user:n,addBadge:o,updateQuizHistory:u,addXp:E}=$(),l=c?decodeURIComponent(c):"",[a,I]=s.useState([]),[d,p]=s.useState(0),[g,m]=s.useState(null),[x,y]=s.useState(0),[k,j]=s.useState(!1),[A,N]=s.useState(!0),[w,h]=s.useState(null),[q,S]=s.useState(0);s.useEffect(()=>{n||r("/login")},[n,r]);const f=s.useCallback(async()=>{j(!1),p(0),y(0),m(null),N(!0),h(null),S(0);try{let t=O(l);t||(t=await G(l),t&&T(l,t)),t&&t.length>0?I(t):h("Sorry, I couldn't generate a quiz for this topic. Please try again later.")}catch(t){console.error(t),h("An error occurred while fetching the quiz.")}finally{N(!1)}},[l]);s.useEffect(()=>{f()},[f]);const L=t=>{m(t)},F=()=>{const t=g===a[d].correctAnswer;if(t&&y(i=>i+1),d===a.length-1){const i=t?x+1:x,z=i*10;if(S(z),n){E(z);const C=i/a.length*100;u(l,C),o("Quiz Whiz"),C===100&&o("Perfect Score")}j(!0)}else p(i=>i+1),m(null)};if(A)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 text-center p-4",children:[e.jsx(R,{className:"w-12 h-12 mb-4"}),e.jsxs("p",{className:"text-lg text-gray-700",children:["Generating your quiz on ",l,"..."]}),e.jsx("p",{className:"text-sm text-gray-500",children:"This might take a moment."})]});if(w)return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 text-center p-4",children:[e.jsx("p",{className:"text-lg text-red-500",children:w}),e.jsx("button",{onClick:()=>r("/dashboard"),className:"mt-4 px-4 py-2 bg-green-600 text-white rounded-md",children:"Back to Dashboard"})]});if(k){const t=Math.round(x/a.length*100);return e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-100 text-center p-4",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-800 mb-2",children:"Quiz Complete!"}),e.jsxs("p",{className:"text-xl text-gray-600 mb-4",children:["You scored ",x," out of ",a.length]}),e.jsxs("p",{className:"text-lg font-semibold text-blue-500 mb-4",children:["+ ",q," XP Earned!"]}),e.jsxs("div",{className:"text-5xl font-bold text-green-600 mb-8",children:[t,"%"]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx("button",{onClick:f,className:"px-6 py-3 bg-green-100 text-green-700 font-semibold rounded-lg",children:"Try Again"}),e.jsx("button",{onClick:()=>r("/dashboard"),className:"px-6 py-3 bg-green-600 text-white font-semibold rounded-lg",children:"Go to Dashboard"})]})]})}const b=a[d];return b?e.jsxs("div",{className:"flex flex-col h-screen bg-gray-100",children:[e.jsxs("header",{className:"bg-white shadow-md sticky top-0 z-10 flex items-center p-4",children:[e.jsx("button",{onClick:()=>r("/dashboard"),className:"p-2 mr-2 rounded-full hover:bg-gray-200",children:e.jsx(X,{className:"w-6 h-6 text-gray-700"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-xl font-bold text-gray-800",children:["Quiz: ",l]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["Question ",d+1," of ",a.length]})]})]}),e.jsx("main",{className:"flex-1 p-4 md:p-8 flex items-center justify-center",children:e.jsxs("div",{className:"w-full max-w-2xl bg-white p-6 rounded-lg shadow-lg",children:[e.jsx("p",{className:"text-lg font-semibold text-gray-800 mb-6",children:b.question}),e.jsx("div",{className:"space-y-3",children:b.options.map((t,Q)=>e.jsx("button",{onClick:()=>L(t),className:`w-full text-left p-4 rounded-lg border-2 transition-colors ${g===t?"bg-green-100 border-green-500":"bg-gray-50 hover:bg-gray-100 border-gray-200"}`,children:t},Q))}),e.jsx("button",{onClick:F,disabled:!g,className:"w-full mt-6 py-3 bg-green-600 text-white font-semibold rounded-lg hover:bg-green-700 disabled:bg-gray-400",children:d<a.length-1?"Next Question":"Finish Quiz"})]})})]}):null};export{J as default};
